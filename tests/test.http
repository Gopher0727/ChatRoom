@baseUrl = http://localhost:9000
@contentType = application/json
@token =

# 健康检查
GET {{baseUrl}}/health HTTP/1.1

### 注册用户 - 用户 1
POST {{baseUrl}}/api/v1/auth/register HTTP/1.1
Content-Type: application/json

{
  "username": "testuser1",
  "email": "test1@example.com",
  "password": "password123"
}

### 注册用户 - 用户 2
POST {{baseUrl}}/api/v1/auth/register HTTP/1.1
Content-Type: application/json

{
  "username": "testuser2",
  "email": "test2@example.com",
  "password": "password123"
}

### 登录 - 用户 1
# @name loginUser1
POST {{baseUrl}}/api/v1/auth/login HTTP/1.1
Content-Type: application/json

{
  "username": "testuser1",
  "password": "password123"
}

###
@token = {{loginUser1.response.body.data.token}}

### 登录 - 用户2
POST {{baseUrl}}/api/v1/auth/login HTTP/1.1
Content-Type: application/json

{
  "username": "testuser2",
  "email": "test2@example.com",
  "password": "password123"
}

###
@token = {{loginUser1.response.body.data.token}}

### 登出
POST {{baseUrl}}/api/v1/user/logout HTTP/1.1
Authorization: Bearer {{token}}

### 创建群组 - 用户 1 创建
POST {{baseUrl}}/api/v1/groups HTTP/1.1
Content-Type: application/json
Authorization: Bearer {{token}}

{
  "name": "测试群组1",
  "description": "这是一个测试群组"
}

### 获取用户的群组列表
GET {{baseUrl}}/api/v1/groups/my?page=1&page_size=20 HTTP/1.1
Authorization: Bearer {{token}}

### 通过邀请码搜索群组
GET {{baseUrl}}/api/v1/groups/search?code=ABC123 HTTP/1.1
Authorization: Bearer {{token}}

### 加入群组
POST {{baseUrl}}/api/v1/groups/join HTTP/1.1
Content-Type: application/json
Authorization: Bearer {{token}}

{
  "group_id": 1
}

### 获取群组详情
GET {{baseUrl}}/api/v1/groups/1 HTTP/1.1
Authorization: Bearer {{token}}

### 获取群组成员列表
GET {{baseUrl}}/api/v1/groups/1/members?page=1&page_size=50 HTTP/1.1
Authorization: Bearer {{token}}

### 离开群组
DELETE {{baseUrl}}/api/v1/groups/1 HTTP/1.1
Authorization: Bearer {{token}}

### 发送消息
POST {{baseUrl}}/api/v1/messages HTTP/1.1
Content-Type: application/json
Authorization: Bearer {{token}}

{
  "group_id": 1,
  "content": "Hello, everyone! This is a test message."
}

### 获取群组消息列表
GET {{baseUrl}}/api/v1/messages/group/1?page=1&page_size=50 HTTP/1.1
Authorization: Bearer {{token}}

### 标记消息已读
POST {{baseUrl}}/api/v1/messages/mark-read HTTP/1.1
Content-Type: application/json
Authorization: Bearer {{token}}

{
  "group_id": 1,
  "msg_id": 1
}

### 获取未读消息数
GET {{baseUrl}}/api/v1/messages/group/1/unread HTTP/1.1
Authorization: Bearer {{token}}

### 获取群组最新序列号
GET {{baseUrl}}/api/v1/messages/group/1/sequence HTTP/1.1
Authorization: Bearer {{token}}

# 测试说明
# 
# 1. 使用步骤：
#    - 首先运行"健康检查"确保服务正常
#    - 运行"注册用户"创建两个测试账户
#    - 运行"登录 - 用户1"或"登录 - 用户2"获取Token
#      * Token会自动提取并保存到@token变量中
#      * 之后所有需要认证的请求都会自动使用该Token
#    - 无需手动复制粘贴Token
#    - 按照需要的流程依次运行其他接口
#
# 2. 常用的测试流程：
#    a. 健康检查 → 注册用户 → 登录用户1 → 创建群组 → 发送消息 → 获取消息列表
#    b. 登录用户2 → 通过邀请码搜索群组 → 加入群组 → 获取消息 → 标记已读
#
# 3. 注意事项：
#    - 确保后端服务运行在 http://localhost:9000
#    - 需要安装REST Client扩展（REST Client by Huachao Mao）
#    - Token自动保存在{{token}}变量中，有效期内自动使用
#    - 如果要使用不同用户的Token，直接运行对应的登录请求即可
#